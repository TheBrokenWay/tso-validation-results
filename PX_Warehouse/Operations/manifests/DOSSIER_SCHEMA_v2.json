{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "PX_Warehouse/DOSSIER_SCHEMA_v2.json",
  "title": "Predator X Finalized Dossier Schema v2",
  "description": "Canonical structure for in-silico trial dossiers (Evidence Package v2 / finalization block)",
  "type": "object",
  "properties": {
    "dossier_version": { "type": "string", "const": "2.0.0" },
    "generated": { "type": "string", "format": "date-time", "description": "ISO-8601 datetime" },
    "alcoa_metadata": {
      "type": "object",
      "properties": {
        "attributable_to": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "original": { "type": "boolean" },
        "complete": { "type": "boolean" },
        "consistent": { "type": "boolean" },
        "contemporaneous": { "type": "boolean" }
      }
    },
    "causal_trace_log": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "law": { "type": "string" },
          "authorization": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" }
        }
      }
    },
    "candidate": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "smiles": { "type": "string" }
      }
    },
    "engines": {
      "type": "object",
      "properties": {
        "ope": {
          "type": "object",
          "properties": {
            "molecular_weight": { "type": "number" },
            "logp": { "type": "number" },
            "hbd": { "type": "number" },
            "hba": { "type": "number" },
            "tpsa": { "type": "number" },
            "ec50": { "type": "number" },
            "emax": { "type": "number" },
            "clearance_estimate_L_per_h": { "type": "number" },
            "vd_estimate_L": { "type": "number" },
            "binding_affinity_nM": { "type": "number" },
            "note": { "type": "string" },
            "version": { "type": "string" }
          }
        },
        "admet": {
          "type": "object",
          "properties": {
            "absorption": {
              "type": "object",
              "properties": {
                "oral_bioavailability_percent": { "type": "number" },
                "intestinal_permeability": { "type": "string" },
                "predicted_bioavailability": { "type": "number" },
                "bcs_class": { "type": "string" }
              }
            },
            "distribution": {
              "type": "object",
              "properties": {
                "plasma_protein_binding_percent": { "type": "number" },
                "vd_L": { "type": "number" },
                "blood_brain_barrier": { "type": "string" },
                "predicted_vd_L_per_kg": { "type": "number" },
                "bbb_penetration": { "type": "string" }
              }
            },
            "metabolism": {
              "type": "object",
              "properties": {
                "hepatic_extraction_ratio": { "type": "number" },
                "clearance_L_per_h": { "type": "number" },
                "half_life_h": { "type": "number" }
              }
            },
            "excretion": {
              "type": "object",
              "properties": {
                "renal_clearance_fraction": { "type": "number" },
                "hepatic_clearance_fraction": { "type": "number" }
              }
            },
            "toxicity": {
              "type": "object",
              "properties": {
                "toxicity_index": { "type": "number" },
                "herg_risk": { "type": "number" },
                "hepatotoxicity_risk": { "type": "number" },
                "ames_mutagenicity": { "type": "number" },
                "risk_level": { "type": "string" },
                "safety_margin": { "type": "number" }
              }
            },
            "toxicity_flags": {
              "type": "object",
              "properties": {
                "hepatotoxicity_risk": { "type": "string" },
                "cardiotoxicity_risk": { "type": "string" }
              }
            },
            "constitutional": {
              "type": "object",
              "properties": {
                "status": { "type": "string" },
                "engine": { "type": "string" },
                "law_basis": { "type": "array", "items": { "type": "string" } }
              }
            },
            "safety_margins": {
              "type": "object",
              "properties": {
                "max_tolerated_cmax_mg_per_L": { "type": "number" },
                "max_tolerated_auc_mg_h_per_L": { "type": "number" },
                "safety_margin": { "type": "number" }
              }
            },
            "toxicity_threshold": { "type": "number" },
            "note": { "type": "string" },
            "version": { "type": "string" }
          }
        }
      }
    },
    "harm_energy": { "type": "number" },
    "context": {
      "type": "object",
      "properties": {
        "physics_snapshot": { "type": ["object", "null"] },
        "law_l1_overrode_external": { "type": "boolean" }
      }
    },
    "fda_compliance": { "type": "string" },
    "constitutional_seal": { "type": "string" },
    "trial_simulation_id": { "type": ["string", "null"] },
    "trial_simulation_hash": { "type": ["string", "null"] },
    "trial_outcome_summary": {
      "type": "object",
      "properties": {
        "status": { "type": "string", "enum": ["VIRTUAL_TRIAL_NOT_RUN", "COMPLETED", "FAILED", "PARTIAL"] },
        "responder_rate": { "type": ["number", "null"] },
        "pta": { "type": ["number", "null"] },
        "toxicity_rate": { "type": ["number", "null"] },
        "effect_size": { "type": ["number", "null"] },
        "uncertainty_bounds": {
          "type": "object",
          "properties": {
            "lower": { "type": ["number", "null"] },
            "upper": { "type": ["number", "null"] },
            "confidence_level": { "type": ["number", "null"] }
          }
        },
        "cohort_statistics": {
          "type": "object",
          "properties": {
            "cohort_size": { "type": ["integer", "null"] },
            "age_distribution": { "type": ["string", "null"] },
            "sex_distribution": { "type": ["string", "null"] },
            "comorbidity_profile": { "type": ["string", "null"] }
          }
        }
      }
    },
    "finalization": {
      "type": "object",
      "properties": {
        "promotion_stage": { "type": "string" },
        "moa_hypothesis": { "type": "string" },
        "disease_space_anchoring": { "type": "array", "items": { "type": "string" } },
        "disease_context": { "type": "array", "items": { "type": "string" } },
        "prv_category": { "type": "string" },
        "prv_rationale": { "type": "string" },
        "prv_eligibility_scoring": {
          "type": "object",
          "properties": {
            "engine": { "type": "string" },
            "compound_id": { "type": "string" },
            "prv_eligible": { "type": "boolean" },
            "freedom_to_operate": { "type": "boolean" },
            "regulatory_pathway": { "type": "string" },
            "status": { "type": "string" }
          }
        },
        "lineage_assignment": {
          "type": "object",
          "properties": {
            "source": { "type": "string" },
            "item_id": { "type": "string" },
            "stage": { "type": "string" },
            "is_novel": { "type": "boolean" }
          }
        },
        "ancestral_trace": {
          "type": "object",
          "properties": {
            "full_chain": { "type": "array", "items": { "type": "string" } },
            "first_seen": { "type": "string", "format": "date-time" },
            "worldline_ids": { "type": "array", "items": { "type": "string" } }
          }
        },
        "physics_map_id": { "type": "string" },
        "physics_map_hash": { "type": "string" },
        "trial_results": {
          "type": "object",
          "properties": {
            "cohort_summary": {
              "type": "object",
              "properties": {
                "cohort_size": { "type": ["integer", "null"] },
                "demographics": { "type": ["string", "null"] },
                "pkpd_variability_model": { "type": ["string", "null"] }
              }
            },
            "dose_response_table": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "dose": { "type": "number" },
                  "responder_rate": { "type": "number" },
                  "toxicity_rate": { "type": "number" },
                  "pta": { "type": ["number", "null"] }
                }
              }
            },
            "pta_curve": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "dose": { "type": "number" },
                  "pta": { "type": "number" }
                }
              }
            },
            "toxicity_curve": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "dose": { "type": "number" },
                  "toxicity_rate": { "type": "number" }
                }
              }
            },
            "effect_size": { "type": ["number", "null"] },
            "uncertainty_intervals": {
              "type": "object",
              "properties": {
                "lower": { "type": ["number", "null"] },
                "upper": { "type": ["number", "null"] },
                "confidence_level": { "type": ["number", "null"] }
              }
            },
            "recommended_dose": { "type": ["number", "null"] },
            "therapeutic_window": {
              "type": "object",
              "properties": {
                "min_dose": { "type": ["number", "null"] },
                "max_dose": { "type": ["number", "null"] }
              }
            }
          }
        },
        "effect_size_vs_soc": {
          "type": "object",
          "properties": {
            "direction": { "type": ["string", "null"], "enum": ["positive", "neutral", "negative", null] },
            "magnitude": { "type": ["number", "null"] },
            "confidence_interval": {
              "type": "object",
              "properties": {
                "lower": { "type": ["number", "null"] },
                "upper": { "type": ["number", "null"] },
                "confidence_level": { "type": ["number", "null"] }
              }
            },
            "better_than_soc": { "type": ["boolean", "null"] }
          }
        },
        "trial_adjusted_prv_score": {
          "type": "object",
          "properties": {
            "efficacy_weight": { "type": ["number", "null"] },
            "safety_weight": { "type": ["number", "null"] },
            "novelty_weight": { "type": ["number", "null"] },
            "soc_weight": { "type": ["number", "null"] },
            "prv_eligible": { "type": ["boolean", "null"] }
          }
        },
        "trial_adjusted_sa_score": { "type": ["number", "null"] },
        "worldline_trial_event": {
          "type": "object",
          "properties": {
            "timestamp": { "type": ["string", "null"] },
            "simulation_id": { "type": ["string", "null"] },
            "trial_hash": { "type": ["string", "null"] },
            "outcome_summary": { "type": "object" },
            "status": { "type": ["string", "null"] },
            "tier_after_trial": { "type": ["string", "null"] }
          }
        },
        "discovery_grading": {
          "type": "object",
          "properties": {
            "grade": { "type": "string" },
            "metrics": {
              "type": "object",
              "properties": {
                "pta": { "type": "number" },
                "responder_rate": { "type": "number" },
                "toxicity": { "type": "number" },
                "dose_score": { "type": "number" },
                "variability_cv": { "type": "number" },
                "binding_affinity": { "type": "number" },
                "trial_responder_rate": { "type": ["number", "null"] },
                "trial_pta": { "type": ["number", "null"] },
                "trial_effect_size": { "type": ["number", "null"] },
                "trial_variability_cv": { "type": ["number", "null"] },
                "trial_toxicity_rate": { "type": ["number", "null"] }
              }
            },
            "reasoning": {
              "type": "object",
              "properties": {
                "grade": { "type": "string" },
                "reason": { "type": "string" },
                "criteria_met_count": { "type": "integer" }
              }
            },
            "timestamp": { "type": "string" },
            "grading_engine_version": { "type": "string" },
            "thresholds_used": { "type": "object" }
          }
        },
        "zeus_verdict": {
          "type": "object",
          "properties": {
            "authorized": { "type": "boolean" },
            "operation": { "type": "string" },
            "rationale": { "type": "string" },
            "timestamp": { "type": "string" },
            "laws_required": { "type": "array", "items": { "type": "string" } },
            "laws_results": { "type": "object" },
            "whole_profile_passed": { "type": "boolean" },
            "all_single_passed": { "type": "boolean" },
            "toxicity_index": { "type": "number" },
            "harm_energy": { "type": "number" },
            "verdict_field": { "type": "string" },
            "harm_energy_under_trial": { "type": ["number", "null"] },
            "toxicity_under_trial": { "type": ["number", "null"] },
            "stability_under_trial": { "type": ["boolean", "null"] }
          }
        },
        "tier": { "type": "string" },
        "finalized_at": { "type": "string" },
        "rep_seal": { "type": "string" },
        "finalization_version": { "type": "string" },
        "spec_compliance_report": {
          "type": "object",
          "properties": {
            "missing_fields": { "type": "array", "items": { "type": "string" } },
            "failed_checks": { "type": "array", "items": { "type": "string" } },
            "passed_checks": { "type": "array", "items": { "type": "string" } },
            "timestamp": { "type": "string" }
          }
        }
      }
    },
    "worldline_generated": { "type": "boolean" },
    "worldline_path": { "type": "string" },
    "refinery_status": { "type": "string" }
  }
}
